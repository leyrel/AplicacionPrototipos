@model Prototipos.Models.ObjectManager.SituacionManager

@{
    Layout = "~/Views/Shared/_Layout5.cshtml";
    ViewBag.Title = "Situación";
    int idProy = ViewBag.idProy;

    int i = 1;
    int f = 1;
    int g = 1;
    int h = 0;
    string si = "Sí";
    string no = "No";
}

<ul id="menuSubIndex">
    <li>@Html.ActionLink("Montaje", "Montaje", new { id = idProy })</li>
    <li>@Html.ActionLink("Resolución", "Resolucion", new { id = idProy })</li>
    <li>@Html.ActionLink("Gestión pruebas", "GestionPruebas", new { id = idProy })</li>
    <li class="selec">@Html.ActionLink("Situación", "Situacion", new { id = idProy })</li>
    <li>@Html.ActionLink("Tratamiento", "Tratamiento", new { id = idProy })</li>
    <li>@Html.ActionLink("Desbloqueo", "Desbloqueo", new { id = idProy })</li>
</ul>

<div class="center">
    @if (Model.TieneDefBloq(Model.ProyectoActual.IdPrototipo) || Model.TieneDefPruebaBloq(Model.ProyectoActual.IdPrototipo))
    {
        <h2 class="rojo">PROTOTIPO BLOQUEADO PARA PRUEBAS</h2>
    }
    <br />
    @if (Model.TieneFaseBloqGrua(Model.ProyectoActual.IdPrototipo) || Model.TienePruebaBloqGrua(Model.ProyectoActual.IdPrototipo))
    {
        <h2 class="rojo">GRÚA KX1953 BLOQUEADA POR ALGUNA PUESTA EN MARCHA O PRUEBA DEL PROYECTO</h2>
    }
</div>

<div class="title">
    <br /><br />
    <h1>@ViewBag.Title</h1>
    <h2>@ViewBag.Message <i>@ViewBag.Message2</i></h2>
</div>

<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>

    <fieldset>

        @Html.HiddenFor(m => m.ProyectoActual.IdPrototipo)

        <h3>- Configuración de montaje:</h3>
        <div class="editor-campSit">
            (Último registro)
        </div>
        <br />
        @if (Model.UltimaFase != null)
        {
            <fieldset class="fieldsetInterior">
                @if (Model.UltimaFase.EsInicial == "Inicial")
                { <h4>Puesta en marcha inicial</h4> }
                else
                { <h4>Puesta en marcha nuevas derivadas</h4> }
                                                                   
                <div class="editor-tituloAlto">
                    @Html.Label("Puesta en marcha: ")
                </div>
                <div class="editor-camp">
                    @Html.DisplayFor(model => model.UltimaFase.FechaPuestaMarcha) - @Html.DisplayFor(model => model.UltimaFase.Usuario)
                </div>

                <div class="editor-titulo">
                    @Html.Label("Configuración de montaje: ")
                </div>
                <div class="editor-camp">
                    @Html.DisplayFor(model => model.UltimaFase.ConfiguracionMontaje)
                </div>

                <div class="editor-titulo">
                    @Html.Label("Observaciones: ")
                </div>
                <div class="editor-camp">
                    @Html.DisplayFor(model => model.UltimaFase.Observaciones)
                </div>

                <div class="rojo">
                    @if (Model.UltimaFase.BloqueoGrua == "Sí" && Model.UltimaFase.UsuarioBloqueoGrua != null)
                    {
                        <div class="editor-tituloRojo">
                            @Html.Label("Bloquea la KX1953: ")
                        </div>
                        <div class="editor-camp">
                            @Model.UltimaFase.BloqueoGrua - Por: @Model.UltimaFase.UsuarioBloqueoGrua
                        </div>
                    }
                </div>
                @if (Model.UltimaFase.BloqueoGrua == "No" && Model.UltimaFase.UsuarioBloqueoGrua != null)
                {
                    <div class="editor-titulo">
                        @Html.Label("Bloquea la KX1953: ")
                    </div>
                    <div class="editor-camp">
                        @Model.UltimaFase.BloqueoGrua - Con anterioridad por: @Model.UltimaFase.UsuarioBloqueoGrua
                    </div>
                }
                @if (Model.UltimaFase.BloqueoGrua == "No" && Model.UltimaFase.UsuarioBloqueoGrua == null)
                {
                    <div class="editor-titulo">
                        @Html.Label("Bloquea la KX1953: ")
                    </div>
                    <div class="editor-camp">
                        @Model.UltimaFase.BloqueoGrua
                    </div>
                }
                                    
                <div class="editor-titulo">
                    @Html.Label("Desmontaje: ")
                </div>
                <div class="editor-camp">
                    @Html.DisplayFor(model => model.UltimaFase.FechaDesmontaje) - @Html.DisplayFor(model => model.UltimaFase.UsuarioDesmontaje)
                </div>

                <div class="editor-titulo">
                    @Html.Label("Desmontaje final: ")
                </div>
                <div class="editor-camp">
                    @if (Model.UltimaFase.DesmontajeFinal == true)
                    {
                        @si
                    }
                   @if (Model.UltimaFase.DesmontajeFinal == false)
                   {
                        @no
                   }
                </div>

                <div class="editor-titulo">
                    @Html.Label("Observaciones desmontaje: ")
                </div>
                <div class="editor-camp">
                    @Html.DisplayFor(model => model.UltimaFase.ObservacionesDesmontaje)
                </div>

                 <div class="editor-titulo">
                    @Html.Label("Observaciones tratamiento: ")
                </div>
                <div class="editor-camp">
                    @Html.DisplayFor(model => model.UltimaFase.ObservacionesTratamiento)
                </div>
                <div class="editor-titulo">
                    @Html.Label("Archivos adjuntos: ")
                </div>
                @if (Model.TieneArchFase(Model.UltimaFase.IdFase))
                {
                    <div class="editor-camp">
                        Sí -> <a href="@Url.Action("MontajeArchivos", "Files", new { id = Model.UltimaFase.IdFase })"  target="_blank" class="button7">Ver archivos</a> 
                    </div>
                }
                else
                {
                    <div class="editor-camp">
                        No
                    </div>
                }
                @if (Model.TieneTratPiezas(Model.UltimaFase.IdFase))
                {
                    <br />
                    <h4>Tratamiento piezas:</h4>
                    foreach (var pieza in Model.tTratamientoPiezas)
                    {
                        if (pieza.IdFase == Model.UltimaFase.IdFase)
                        {
                            <fieldset class="fieldsetInterior">
                                <h4>Pieza @g</h4>
                                @{g++;}
                                <div class="editor-tituloAlto">
                                    @Html.Label("Artículo: ")
                                </div>
                                <div class="editor-campMenos">
                                    @pieza.Articulo
                                </div>
                                <div class="editor-titulo">
                                    @Html.Label("Acción: ")
                                </div>
                                <div class="editor-campMenos">
                                    @pieza.Accion
                                </div>
                            </fieldset>
                        }
                        g = 1;
                    }
                }
            </fieldset>
        }
        else
        {
            <h4>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp Puestas en marcha:</h4>
            <div class="editor-campSit">
                No existen registros de montaje inicial o puesta en marcha de nuevas derivadas<br /><br />
            </div>
        }
                
        <h3>- Deficiencias sin resolución:</h3>
        @if (Model.TieneDefNoResuelta(Model.ProyectoActual.IdPrototipo) || Model.TieneDefPruebaNoResuelta(Model.ProyectoActual.IdPrototipo))
        {
            if (Model.TieneDefBloq(Model.ProyectoActual.IdPrototipo) || Model.TieneDefPruebaBloq(Model.ProyectoActual.IdPrototipo))
            {
                <h4 class="defsBloq">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp -> Deficiencias con bloqueo:</h4>
                if (Model.TieneDefBloq(Model.ProyectoActual.IdPrototipo))
                {
                    <div class="rojo">
                        <h4 class="titulosBloq">De puestas en marcha:</h4>
                        @foreach (var def in Model.v_defUsuarios)
                        {
                            if (def.IdPrototipo == Model.ProyectoActual.IdPrototipo && def.Bloqueo == "Sí" && def.FechaResolucion == null)
                            {
                                <fieldset class="fieldsetInteriorMas">
                                    <h4 class="rojo">Deficiencia @i</h4>
                                    @{i++;}
                                    <div class="editor-tituloRojo">
                                        @Html.Label("Creación: ")
                                    </div>
                                    <div class="editor-camp">
                                        @def.Fecha - @def.UsuarioCreador
                                    </div>
                                    <div class="editor-tituloRojo">
                                        @Html.Label("Descripción: ")
                                    </div>
                                    <div class="editor-campNegrita">
                                        @def.Descripcion
                                    </div>
                                    <div class="editor-tituloRojo">
                                        @Html.Label("Limitaciones: ")
                                    </div>
                                    <div class="editor-camp">
                                        @def.Limitaciones
                                    </div>
                                    <div class="editor-tituloSisteRojo">
                                        @Html.Label("Sistemas a los que afecta: ")
                                    </div>
                                    <div class="editor-campSiste">
                                        @foreach (var sist in Model.v_faseAfectaSistema)
                                        {
                                            if (sist.IdDeficienciaFas == def.IdDeficiencia)
                                            {
                                                if (@sist.Nombre == "Otros (especificar)")
                                                {
                                                    <div>Otros: @sist.Otros</div>
                                                }
                                                else
                                                {
                                                    @sist.Nombre<br />
                                                }
                                            }
                                        }
                                    </div>
                                    @if (def.Bloqueo == "Sí" && def.UsuarioBloqueo != null)
                                    {
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Bloqueo: ")
                                        </div>
                                        <div class="editor-camp">
                                            @def.Bloqueo - Por: @def.UsuarioBloqueo
                                        </div>
                                    }
                                    @if (def.Bloqueo == "No" && def.UsuarioBloqueo != null)
                                    {
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Bloqueo: ")
                                        </div>
                                        <div class="editor-camp">
                                            @def.Bloqueo - Con anterioridad por: @def.UsuarioBloqueo
                                        </div>
                                    }
                                    @if (def.Bloqueo == "No" && def.UsuarioBloqueo == null)
                                    {
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Bloqueo: ")
                                        </div>
                                        <div class="editor-camp">
                                            @def.Bloqueo
                                        </div>
                                    }
                                    @if (def.FechaDesbloqueo != null)
                                    {
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Desbloqueo: ")
                                        </div>
                                        <div class="editor-camp">
                                            @def.FechaDesbloqueo - @def.UsuarioDesbloqueo
                                        </div>
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Razon desbloqueo: ")
                                        </div>
                                        <div class="editor-camp">
                                            @def.RazonDesbloqueo
                                        </div>
                                    }
                                    @if (def.FechaResolucion != null)
                                    {
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Resolución: ")
                                        </div>
                                        <div class="editor-camp">
                                            @def.FechaResolucion - @def.UsuarioResolucion
                                        </div>
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Observaciones resolución: ")
                                        </div>
                                        <div class="editor-camp">
                                            @def.ObservacionesResolucion
                                        </div>
                                    }
                                    <div class="editor-tituloRojo">
                                        @Html.Label("Archivos adjuntos: ")
                                    </div>
                                    @if (Model.TieneArchDefFase(def.IdDeficiencia))
                                    {
                                        <div class="editor-camp">
                                            Sí -> <a href="@Url.Action("DefArchivos", "Files", new { id = def.IdDeficiencia })"  target="_blank" class="button7">Ver archivos</a> 
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="editor-camp">
                                            No
                                        </div>
                                    }
                                </fieldset>
                            }
                        }
                    </div>
                    <br />
                }
                { i = 1; }
                if (Model.TieneDefPruebaBloq(Model.ProyectoActual.IdPrototipo))
                {
                    <div class="rojo">
                        <h4 class="titulosBloq">De pruebas:</h4>
                        @foreach (var defPru in Model.v_defPruebaUsuarios)
                        {
                            if (defPru.IdPrototipo == Model.ProyectoActual.IdPrototipo && defPru.Bloqueo == "Sí" && defPru.FechaResolucion == null)
                            {
                                <fieldset class="fieldsetInteriorMas">
                                    <h4 class="rojo">Deficiencia @i</h4>
                                    @{i++;}
                                    <div class="editor-tituloRojo">
                                        @Html.Label("Creación: ")
                                    </div>
                                    <div class="editor-camp">
                                        @defPru.Fecha - @defPru.UsuarioCreador
                                    </div>
                                    <div class="editor-tituloRojo">
                                        @Html.Label("Descripción: ")
                                    </div>
                                    <div class="editor-campNegrita">
                                        @defPru.Descripcion
                                    </div>
                                    <div class="editor-tituloRojo">
                                        @Html.Label("Limitaciones: ")
                                    </div>
                                    <div class="editor-camp">
                                        @defPru.Limitaciones
                                    </div>
                                    <div class="editor-tituloSisteRojo">
                                        @Html.Label("Sistemas a los que afecta: ")
                                    </div>
                                    <div class="editor-campSiste">
                                        @foreach (var sistPru in Model.v_pruebaAfectaSistema)
                                        {
                                            if (sistPru.IdDeficienciaPru == defPru.IdDeficiencia)
                                            {
                                                if (sistPru.Nombre == "Otros (especificar)")
                                                {
                                                    <div>Otros: @sistPru.Otros</div>
                                                }
                                                else
                                                {
                                                    @sistPru.Nombre<br />
                                                }
                                            }
                                        }
                                    </div>
                                    @if (defPru.Bloqueo == "Sí" && defPru.UsuarioBloqueo != null)
                                    {
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Bloqueo: ")
                                        </div>
                                        <div class="editor-camp">
                                            @defPru.Bloqueo - Por: @defPru.UsuarioBloqueo
                                        </div>
                                    }
                                    @if (defPru.Bloqueo == "No" && defPru.UsuarioBloqueo != null)
                                    {
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Bloqueo: ")
                                        </div>
                                        <div class="editor-camp">
                                            @defPru.Bloqueo - Con anterioridad por: @defPru.UsuarioBloqueo
                                        </div>
                                    }
                                    @if (defPru.Bloqueo == "No" && defPru.UsuarioBloqueo == null)
                                    {
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Bloqueo: ")
                                        </div>
                                        <div class="editor-camp">
                                            @defPru.Bloqueo
                                        </div>
                                    }
                                    @if (defPru.FechaDesbloqueo != null)
                                    {
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Desbloqueo: ")
                                        </div>
                                        <div class="editor-camp">
                                            @defPru.FechaDesbloqueo - @defPru.UsuarioDesbloqueo
                                        </div>
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Razon desbloqueo: ")
                                        </div>
                                        <div class="editor-camp">
                                            @defPru.RazonDesbloqueo
                                        </div>
                                    }
                                    @if (defPru.FechaResolucion != null)
                                    {
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Resolución: ")
                                        </div>
                                        <div class="editor-camp">
                                            @defPru.FechaResolucion - @defPru.UsuarioResolucion
                                        </div>
                                        <div class="editor-tituloRojo">
                                            @Html.Label("Observaciones resolución: ")
                                        </div>
                                        <div class="editor-camp">
                                            @defPru.ObservacionesResolucion
                                        </div>
                                    }
                                    <div class="editor-tituloRojo">
                                        @Html.Label("Archivos adjuntos: ")
                                    </div>
                                    @if (Model.TieneArchDefPru(defPru.IdDeficiencia))
                                    {
                                        <div class="editor-camp">
                                            Sí -> <a href="@Url.Action("DefPruArchivos", "Files", new { id = defPru.IdDeficiencia })"  target="_blank" class="button7">Ver archivos</a> 
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="editor-camp">
                                            No
                                        </div>
                                    }
                                </fieldset>
                            }
                        }
                    </div>
                }
                { i = 1; }
            }
            else
            {
                <h4>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp -> Deficiencias con bloqueo:</h4>
                <div class="editor-campSitInt">
                    No tiene<br />
                </div>
            }

            if (Model.TieneDefNoResueltaSinBloq(Model.ProyectoActual.IdPrototipo) || Model.TieneDefNoResueltaPruebaSinBloq(Model.ProyectoActual.IdPrototipo))
            {
                <br />
                <h4>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp -> Resto sin resolver: </h4>
                if (Model.TieneDefNoResueltaSinBloq(Model.ProyectoActual.IdPrototipo))
                {
                    <h4 class="titulosBloq">De puestas en marcha:</h4>
                    foreach (var def in Model.v_defUsuarios)
                    {
                        if (def.IdPrototipo == Model.ProyectoActual.IdPrototipo && def.FechaResolucion == null && def.Bloqueo == "No")
                        {
                            <fieldset class="fieldsetInteriorMas">
                                <h4>Deficiencia @i</h4>
                                @{i++;}
                                <div class="editor-tituloAlto">
                                    @Html.Label("Creación: ")
                                </div>
                                <div class="editor-camp">
                                    @def.Fecha - @def.UsuarioCreador
                                </div>
                                <div class="editor-titulo">
                                    @Html.Label("Descripción: ")
                                </div>
                                <div class="editor-campNegrita">
                                    @def.Descripcion
                                </div>
                                <div class="editor-titulo">
                                    @Html.Label("Limitaciones: ")
                                </div>
                                <div class="editor-camp">
                                    @def.Limitaciones
                                </div>
                                <div class="editor-tituloSiste">
                                    @Html.Label("Sistemas a los que afecta: ")
                                </div>
                                <div class="editor-campSiste">
                                    @foreach (var sist in Model.v_faseAfectaSistema)
                                    {
                                        if (sist.IdDeficienciaFas == def.IdDeficiencia)
                                        {
                                            if (@sist.Nombre == "Otros (especificar)")
                                            {
                                                <div>Otros: @sist.Otros</div>
                                            }
                                            else
                                            {
                                                @sist.Nombre<br />
                                            }
                                        }
                                    }
                                </div>
                                @if (def.Bloqueo == "Sí" && def.UsuarioBloqueo != null)
                                {
                                    <div class="editor-titulo">
                                        @Html.Label("Bloqueo: ")
                                    </div>
                                    <div class="editor-camp">
                                        @def.Bloqueo - Por: @def.UsuarioBloqueo
                                    </div>
                                }
                                @if (def.Bloqueo == "No" && def.UsuarioBloqueo != null)
                                {
                                    <div class="editor-titulo">
                                        @Html.Label("Bloqueo: ")
                                    </div>
                                    <div class="editor-camp">
                                        @def.Bloqueo - Con anterioridad por: @def.UsuarioBloqueo
                                    </div>
                                }
                                @if (def.Bloqueo == "No" && def.UsuarioBloqueo == null)
                                {
                                    <div class="editor-titulo">
                                        @Html.Label("Bloqueo: ")
                                    </div>
                                    <div class="editor-camp">
                                        @def.Bloqueo
                                    </div>
                                }
                                @if (def.FechaDesbloqueo != null)
                                {
                                    <div class="editor-titulo">
                                        @Html.Label("Desbloqueo: ")
                                    </div>
                                    <div class="editor-camp">
                                        @def.FechaDesbloqueo -  @def.UsuarioDesbloqueo
                                    </div>
                                    <div class="editor-titulo">
                                        @Html.Label("Razon desbloqueo: ")
                                    </div>
                                    <div class="editor-camp">
                                        @def.RazonDesbloqueo
                                    </div>
                                }
                                @if (def.FechaResolucion != null)
                                {
                                    <div class="editor-titulo">
                                        @Html.Label("Resolución: ")
                                    </div>
                                    <div class="editor-camp">
                                        @def.FechaResolucion - @def.UsuarioResolucion
                                    </div>
                                    <div class="editor-titulo">
                                        @Html.Label("Observaciones resolución: ")
                                    </div>
                                    <div class="editor-camp">
                                        @def.ObservacionesResolucion
                                    </div>
                                }
                                <div class="editor-titulo">
                                    @Html.Label("Archivos adjuntos: ")
                                </div>
                                @if (Model.TieneArchDefFase(def.IdDeficiencia))
                                {
                                    <div class="editor-camp">
                                        Sí -> <a href="@Url.Action("DefArchivos", "Files", new { id = def.IdDeficiencia })"  target="_blank" class="button7">Ver archivos</a> 
                                    </div>
                                }
                                else
                                {
                                    <div class="editor-camp">
                                        No
                                    </div>
                                }
                            </fieldset>
                        }
                    }
                    <br />
                }
                { i = 1; }
                if (Model.TieneDefNoResueltaPruebaSinBloq(Model.ProyectoActual.IdPrototipo))
                {
                    <h4 class="titulosBloq">De pruebas:</h4>
                    foreach (var defPru in Model.v_defPruebaUsuarios)
                    {
                        if (defPru.IdPrototipo == Model.ProyectoActual.IdPrototipo && defPru.FechaResolucion == null && defPru.Bloqueo == "No")
                        {
                            <fieldset class="fieldsetInteriorMas">
                                <h4>Deficiencia @i</h4>
                                @{i++;}
                                <div class="editor-tituloAlto">
                                    @Html.Label("Creación: ")
                                </div>
                                <div class="editor-camp">
                                    @defPru.Fecha - @defPru.UsuarioCreador
                                </div>
                                <div class="editor-titulo">
                                    @Html.Label("Descripción: ")
                                </div>
                                <div class="editor-campNegrita">
                                    @defPru.Descripcion
                                </div>
                                <div class="editor-titulo">
                                    @Html.Label("Limitaciones: ")
                                </div>
                                <div class="editor-camp">
                                    @defPru.Limitaciones
                                </div>
                                <div class="editor-tituloSiste">
                                    @Html.Label("Sistemas a los que afecta: ")
                                </div>
                                <div class="editor-campSiste">
                                    @foreach (var sistPru in Model.v_pruebaAfectaSistema)
                                    {
                                        if (sistPru.IdDeficienciaPru == defPru.IdDeficiencia)
                                        {
                                            if (sistPru.Nombre == "Otros (especificar)")
                                            {
                                                <div>Otros: @sistPru.Otros</div>
                                            }
                                            else
                                            {
                                                @sistPru.Nombre<br />
                                            }
                                        }
                                    }
                                </div>
                                @if (defPru.Bloqueo == "Sí" && defPru.UsuarioBloqueo != null)
                                {
                                    <div class="editor-titulo">
                                        @Html.Label("Bloqueo: ")
                                    </div>
                                    <div class="editor-camp">
                                        @defPru.Bloqueo - Por: @defPru.UsuarioBloqueo
                                    </div>
                                }
                                @if (defPru.Bloqueo == "No" && defPru.UsuarioBloqueo != null)
                                {
                                    <div class="editor-titulo">
                                        @Html.Label("Bloqueo: ")
                                    </div>
                                    <div class="editor-camp">
                                        @defPru.Bloqueo - Con anterioridad por: @defPru.UsuarioBloqueo
                                    </div>
                                }
                                @if (defPru.Bloqueo == "No" && defPru.UsuarioBloqueo == null)
                                {
                                    <div class="editor-titulo">
                                        @Html.Label("Bloqueo: ")
                                    </div>
                                    <div class="editor-camp">
                                        @defPru.Bloqueo
                                    </div>
                                }
                                @if (defPru.FechaDesbloqueo != null)
                                {
                                    <div class="editor-titulo">
                                        @Html.Label("Desbloqueo: ")
                                    </div>
                                    <div class="editor-camp">
                                        @defPru.FechaDesbloqueo -  @defPru.UsuarioDesbloqueo
                                    </div>
                                    <div class="editor-titulo">
                                        @Html.Label("Razon desbloqueo: ")
                                    </div>
                                    <div class="editor-camp">
                                        @defPru.RazonDesbloqueo
                                    </div>
                                }
                                @if (defPru.FechaResolucion != null)
                                {
                                    <div class="editor-titulo">
                                        @Html.Label("Resolución: ")
                                    </div>
                                    <div class="editor-camp">
                                        @defPru.FechaResolucion - @defPru.UsuarioResolucion
                                    </div>
                                    <div class="editor-titulo">
                                        @Html.Label("Observaciones resolución: ")
                                    </div>
                                    <div class="editor-camp">
                                        @defPru.ObservacionesResolucion
                                    </div>
                                }
                                <div class="editor-titulo">
                                    @Html.Label("Archivos adjuntos: ")
                                </div>
                                @if (Model.TieneArchDefPru(defPru.IdDeficiencia))
                                {
                                    <div class="editor-camp">
                                        Sí -> <a href="@Url.Action("DefPruArchivos", "Files", new { id = defPru.IdDeficiencia })"  target="_blank" class="button7">Ver archivos</a> 
                                    </div>
                                }
                                else
                                {
                                    <div class="editor-camp">
                                        No
                                    </div>
                                }
                            </fieldset>
                        }
                    }
                }
                { i = 1; }
            }
            <h3 class="arriba">- Sistemas de seguridad afectados por las deficiencias sin resolución:</h3>
            if (Model.AfectaSistemasFase(Model.ProyectoActual.IdPrototipo))
            {
                <h4>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp Por puestas en marcha: </h4>
                foreach (var sist in Model.v_faseSinResSistemas)
                {
                    if (sist.IdPrototipo == Model.ProyectoActual.IdPrototipo && sist.Nombre != "Otros (especificar)")
                    {
                        <p class="sistemas">@sist.Nombre</p>
                    }
                    else if (sist.IdPrototipo == Model.ProyectoActual.IdPrototipo && sist.Nombre == "Otros (especificar)" && h == 0)
                    {
                        foreach (var otros in Model.otrosFaseSinRes(sist.IdPrototipo))
                        {
                            <p class="sistemas">Otros: @otros </p>
                            h++;
                        }
                    }
                }
            }
            h = 0;
            if (Model.AfectaSistemasPrueba(Model.ProyectoActual.IdPrototipo))
            {
                <h4>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp Por pruebas: </h4>
                foreach (var sist in Model.v_pruebaSinResSistemas)
                {
                    if (sist.IdPrototipo == Model.ProyectoActual.IdPrototipo && sist.Nombre != "Otros (especificar)")
                    {
                        <p class="sistemas">@sist.Nombre</p>
                    }
                    else if (sist.IdPrototipo == Model.ProyectoActual.IdPrototipo && sist.Nombre == "Otros (especificar)" && h == 0)
                    {
                        foreach (var otros in Model.otrosPruebaSinRes(sist.IdPrototipo))
                        {
                            <p class="sistemas">Otros: @otros </p>
                            h++;
                        }
                    }
                }
            }
            h = 0;
        }
        else
        {
            <div class="editor-campSit">
                No tiene<br />
            </div>
        }
        <br />
        <h3>- Registros de pruebas de los últimos 7 días:</h3>
        @if (Model.TienePruebasSemana(Model.ProyectoActual.IdPrototipo))
        {
            foreach (var pru in Model.v_pruebaUsSemana)
            {
                if (pru.IdPrototipo == Model.ProyectoActual.IdPrototipo)
                {
                    <fieldset class="fieldsetInteriorPrueba">
                        <h4 class="menosMargen">Prueba @i</h4>
                    
                        <div class="editor-titulo">
                            @Html.Label("Prueba: ")
                        </div>
                        <div class="editor-camp">
                            @pru.FechaPrueba - @pru.Usuario
                        </div>
                        <div class="editor-titulo">
                            @Html.Label("Actividad realizada: ")
                        </div>
                        <div class="editor-camp">
                            @pru.Prueba
                        </div>
                        <div class="rojo">
                            @if (pru.BloqueoGrua == "Sí" && pru.UsuarioBloqueoGrua != null)
                            {
                                <div class="editor-tituloRojo">
                                    @Html.Label("Bloquea la KX1953: ")
                                </div>
                                <div class="editor-camp">
                                    @pru.BloqueoGrua - Por: @pru.UsuarioBloqueoGrua
                                </div>
                            }
                        </div>
                        @if (pru.BloqueoGrua == "No" && pru.UsuarioBloqueoGrua != null)
                        {
                            <div class="editor-titulo">
                                @Html.Label("Bloquea la KX1953: ")
                            </div>
                            <div class="editor-camp">
                                @pru.BloqueoGrua - Con anterioridad por: @pru.UsuarioBloqueoGrua
                            </div>
                        }
                        @if (pru.BloqueoGrua == "No" && pru.UsuarioBloqueoGrua == null)
                        {
                            <div class="editor-titulo">
                                @Html.Label("Bloquea la KX1953: ")
                            </div>
                            <div class="editor-camp">
                                @pru.BloqueoGrua
                            </div>
                        }
                        <div class="editor-titulo">
                            @Html.Label("Archivos adjuntos: ")
                        </div>
                        @if (Model.TieneArchPrueba(pru.IdPrueba))
                        {
                            <div class="editor-camp">
                                Sí -> <a href="@Url.Action("PruebaArchivos", "Files", new { id = pru.IdPrueba })"  target="_blank" class="button7">Ver archivos</a> 
                            </div>
                        }
                        else
                        {
                            <div class="editor-camp">
                                No
                            </div>
                        }
                        <br />
                        @if (Model.TieneDefPrueba(pru.IdPrueba))
                        {
                            <h4>Deficiencias:</h4>
                            foreach (var defPru in Model.v_defPruebaUsuarios)
                            {
                                if (defPru.IdPrototipo == Model.ProyectoActual.IdPrototipo && pru.IdPrueba == defPru.IdPrueba)
                                {
                                    <fieldset class="fieldsetInterior">
                                        @if (defPru.FechaResolucion == null)
                                        {
                                            <h4 class='menosMargen'>Deficiencia @i .@f - Deficiencia sin resolver</h4>
                                            f++;
                                        }
                                        else
                                        {
                                            <h4 class='menosMargen'>Deficiencia @i .@f - Deficiencia resuelta</h4>
                                            f++;
                                        }
                                        <div class="editor-titulo">
                                            @Html.Label("Creación: ")
                                        </div>
                                        <div class="editor-camp">
                                            @defPru.Fecha - @defPru.UsuarioCreador
                                        </div>
                                        <div class="editor-titulo">
                                            @Html.Label("Descripción: ")
                                        </div>
                                        <div class="editor-campNegrita">
                                            @defPru.Descripcion
                                        </div>
                                        <div class="editor-titulo">
                                            @Html.Label("Limitaciones: ")
                                        </div>
                                        <div class="editor-camp">
                                            @defPru.Limitaciones
                                        </div>
                                        <div class="editor-tituloSiste">
                                            @Html.Label("Sistemas a los que afecta: ")
                                        </div>
                                        <div class="editor-campSiste">
                                        @foreach (var sistPru in Model.v_pruebaAfectaSistema)
                                        {
                                            if (sistPru.IdDeficienciaPru == defPru.IdDeficiencia)
                                            {
                                                if (sistPru.Nombre == "Otros (especificar)")
                                                {
                                                        <div>Otros: @sistPru.Otros</div>
                                                }
                                                else
                                                {
                                                        @sistPru.Nombre<br />
                                                }
                                            }
                                        }
                                        </div>
                                        @if (defPru.Bloqueo == "Sí" && defPru.UsuarioBloqueo != null)
                                        {
                                            <div class="editor-titulo">
                                                @Html.Label("Bloqueo: ")
                                            </div>
                                            <div class="editor-camp">
                                                @defPru.Bloqueo - Por: @defPru.UsuarioBloqueo
                                            </div>
                                        }
                                        @if (defPru.Bloqueo == "No" && defPru.UsuarioBloqueo != null)
                                        {
                                            <div class="editor-titulo">
                                                @Html.Label("Bloqueo: ")
                                            </div>
                                            <div class="editor-camp">
                                                @defPru.Bloqueo - Con anterioridad por: @defPru.UsuarioBloqueo
                                            </div>
                                        }
                                        @if (defPru.Bloqueo == "No" && defPru.UsuarioBloqueo == null)
                                        {
                                            <div class="editor-titulo">
                                                @Html.Label("Bloqueo: ")
                                            </div>
                                            <div class="editor-camp">
                                                @defPru.Bloqueo
                                            </div>
                                        }
                                        @if (defPru.FechaDesbloqueo != null)
                                        {
                                            <div class="editor-titulo">
                                                @Html.Label("Desbloqueo: ")
                                            </div>
                                            <div class="editor-camp">
                                                @defPru.FechaDesbloqueo - @defPru.UsuarioDesbloqueo
                                            </div>
                                            <div class="editor-titulo">
                                                @Html.Label("Razon desbloqueo: ")
                                            </div>
                                            <div class="editor-camp">
                                                @defPru.RazonDesbloqueo
                                            </div>
                                        }
                                        @if (defPru.FechaResolucion != null)
                                        {
                                            <div class="editor-titulo">
                                                @Html.Label("Resolución: ")
                                            </div>
                                            <div class="editor-camp">
                                                @defPru.FechaResolucion - @defPru.UsuarioResolucion
                                            </div>
                                            <div class="editor-titulo">
                                                @Html.Label("Observaciones resolución: ")
                                            </div>
                                            <div class="editor-camp">
                                                @defPru.ObservacionesResolucion
                                            </div>
                                        }
                                        <div class="editor-titulo">
                                            @Html.Label("Archivos adjuntos: ")
                                        </div>
                                        @if (Model.TieneArchDefPru(defPru.IdDeficiencia))
                                        {
                                            <div class="editor-camp">
                                                Sí -> <a href="@Url.Action("DefPruArchivos", "Files", new { id = defPru.IdDeficiencia })"  target="_blank" class="button7">Ver archivos</a> 
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="editor-camp">
                                                No
                                            </div>
                                        }
                                    </fieldset>
                                }
                            }
                        }
                        else
                        {
                            <h4>Deficiencias:</h4>
                            <div class="editor-camp">
                                @pru.Deficiencia tiene
                            </div>
                            <br />
                        }
                        @{i++; f = 1;}
                    </fieldset>
                }
            }
        }
        else
        {
            <div class="editor-campSit3">
                No tiene
            </div>
        }
    </fieldset>
    <br /><br />
    <div class="center">
        <a href="@Url.Action("ImprimirSituacion", "Home", new { id = idProy })" target="_blank" class="button4">Imprimir</a>
    </div>
<h5>
    @Html.ActionLink("Ir a principal", "Index")
    <span class="float-right">
        @Html.ActionLink("Atrás a proyecto", "GestionProyecto", new { id = idProy })
    </span>
</h5>